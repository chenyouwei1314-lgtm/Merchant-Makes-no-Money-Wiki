<!DOCTYPE html>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“å…·å•†äººæ²’éŒ¢é€” Wiki</title>
    <link rel="stylesheet" href="style1.css">
    <link rel="icon" href="favicon.png" type="image/png">
</head>
<body>
    <header>
        <a href="é¦–é .html"><h1>é“å…·å•†äººæ²’<span style="color: rgb(233, 164, 67);">éŒ¢</span>é€” 
            <span class="dis1"> Merchant Makes no <span style="color: rgb(233, 164, 67);">Money</span></span></h1></a>
        <nav>
            <div class="top">
                <h3 class="wiki">WIKI</h3>
                <img src="lens_pattern.png" width="70px" height="35px">
                <form id="searchForm">
                    <input id="searchInput" name="search" type="text" placeholder="Search" />
                </form>
            </div>
            <ul data-books></ul>
        </nav>
    </header>
    <main>
        <section class="tit1">
            <h2>æœå°‹çµæœ Search Result</h2>
        </section>
        <p style="width: 100%; border-top: 3px solid rgb(80, 25, 25); margin-bottom: 22px;"></p>
        <section class="sum2">
        <ul id="search-results"></ul>
        </section>    
    </main>
    <footer>
        <p>Copyright <span style="font-weight: bold;">@Merchant Makes no Money</span> All Rights Reserved</p>
    </footer>
    <script>
// ğŸ”§ æœå°‹ç´¢å¼•æª”æ¡ˆçš„ä½ç½®ï¼ˆè·Ÿæœ¬é åŒä¸€å€‹è³‡æ–™å¤¾ï¼‰
const INDEX_URL = 'search-index.json';

// è®€ç¶²å€çš„ ?q=
function getQueryFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return (params.get('q') || '').trim();
}

// å®‰å…¨è™•ç†æ­£å‰‡ç”¨
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// é—œéµå­—æ¨™è‰²
function highlightKeyword(text, keyword) {
    if (!keyword) return text;
    const pattern = new RegExp('(' + escapeRegExp(keyword) + ')', 'gi');
    return text.replace(pattern, '<span class="highlight-keyword">$1</span>');
}

// å¾æ•´ç¯‡ content åšæ‘˜è¦ï¼ˆæŠ“ç¬¬ä¸€æ¬¡å‡ºç¾çš„ä½ç½®é™„è¿‘ï¼‰
function makeSnippet(content, keyword) {
    const lowerText = content.toLowerCase();
    const lowerKey  = keyword.toLowerCase();
    const idx = lowerText.indexOf(lowerKey);

    if (idx === -1) {
        return (content.slice(0, 80) || '') + '...';
    }

    const start = Math.max(0, idx - 40);
    const end   = Math.min(content.length, idx + 40);
    let snippet = content.slice(start, end).trim();

    if (start > 0) snippet = '...' + snippet;
    if (end < content.length) snippet = snippet + '...';

    return snippet;
}

// ä¸»æœå°‹å‡½å¼ï¼šè®€ index â†’ ç¯©é¸ â†’ ç•«çµæœ
async function runSearch(query) {
    const resultList  = document.getElementById('search-results');
    const searchInput = document.getElementById('searchInput'); // header é‚£å€‹æ¬„ä½ï¼ˆå¦‚æœæœ‰ï¼‰
    if (!resultList) return;

    if (searchInput) {
        searchInput.value = query;
    }

    resultList.innerHTML = '<li>æœå°‹ä¸­...</li>';

    try {
        const resp = await fetch(INDEX_URL);
        const index = await resp.json(); // [{url, title, content}, ...]

        const lowerQ = query.toLowerCase();
        const results = [];

        index.forEach(item => {
            const inTitle   = item.title.toLowerCase().includes(lowerQ);
            const inContent = item.content.toLowerCase().includes(lowerQ);

            if (!inTitle && !inContent) return;

            const snippet = makeSnippet(item.content, query);

            results.push({
                url: item.url,
                title: item.title,
                snippet: snippet
            });
        });

        // ç•«å‡ºçµæœ
        resultList.innerHTML = '';

        if (!results.length) {
            const li = document.createElement('li');
            li.textContent = 'æ‰¾ä¸åˆ°ç›¸é—œçµæœ';
            resultList.appendChild(li);
            return;
        }

        results.forEach(item => {
            const li = document.createElement('li');

            const link = document.createElement('a');
            link.href = item.url;
            link.innerHTML = highlightKeyword(item.title, query);

            const p = document.createElement('p');
            p.innerHTML = highlightKeyword(item.snippet, query);

            li.appendChild(link);
            li.appendChild(p);
            resultList.appendChild(li);
        });

    } catch (err) {
        console.error('è¼‰å…¥æœå°‹ç´¢å¼•å¤±æ•—ï¼š', err);
        resultList.innerHTML = '<li>è¼‰å…¥æœå°‹ç´¢å¼•å¤±æ•—ï¼Œè«‹ç¢ºèª search-index.json æœ‰ä¸Šå‚³</li>';
    }
}

// é€²åˆ°æœå°‹çµæœé å°±è‡ªå‹•è·‘ä¸€æ¬¡
const initialQ = getQueryFromUrl();
if (initialQ) {
    runSearch(initialQ);
}

// åœ¨é€™ä¸€é ä¸Šå†æœä¸€æ¬¡ï¼ˆheader é‚£å€‹æœå°‹æ¬„ï¼‰ï¼Œå°±é‡æ–°å°å‘è‡ªå·±
const searchForm  = document.getElementById('searchForm');
const searchInput = document.getElementById('searchInput');

if (searchForm && searchInput) {
    searchForm.addEventListener('submit', function (event) {
        event.preventDefault();
        const q = searchInput.value.trim();
        if (!q) return;
        window.location.href = 'æœå°‹çµæœ.html?q=' + encodeURIComponent(q);
    });
}
</script>
</body>
</html>